@using Application.Chat.Dto
@model List<ChatDto>
@{
  var id = int.Parse(Context.User.Claims.FirstOrDefault(cl => cl.Type == "Id")?.Value);
  var url = Context.User.Claims.FirstOrDefault(cl => cl.Type == "PhotoUrl")?.Value;
}
<section>
  <div class="row">
    <div class="col-md-12">

      <div class="" id="chat3">
        <div class="">

          <div class="row">
            <div class="col-md-6 col-lg-5 col-xl-4 mb-4 mb-md-0">

              <div class="p-3">

                <div class="input-group rounded mb-3">
                  <input type="search" class="form-control rounded" placeholder="Search" aria-label="Search"
                         aria-describedby="search-addon" />
                  <span class="input-group-text border-0" id="search-addon">
                    <i class="fas fa-search"></i>
                  </span>
                </div>

                <div data-mdb-perfect-scrollbar-init style="overflow-y: auto;height: 80vh; border: 1px solid #ccc; border-radius: 5px; padding: 10px;">
                  <ul class="list-unstyled mb-0">
                    @{
                      foreach (var chat in Model)
                      {
                        <li class="p-2 border-bottom">
                          <a href="@chat.Id" class="d-flex justify-content-between">
                            <div class="d-flex flex-row">
                              <div>
                                <img
                                  src="@chat.Users.First(us => us.Id != id).AvtarUrl"
                                  alt="avatar" class="d-flex align-self-center me-3" width="60">
                                <span class="badge bg-warning badge-dot"></span>
                              </div>
                              <div class="pt-1">
                                <p class="fw-bold mb-0">@chat.Users.First(us => us.Id != id).FullName</p>
                                <p class="small text-muted">Недавно в сообществе</p>
                              </div>
                            </div>
                            <div class="pt-1">
                              <p class="small text-muted mb-1">5 mins ago</p>
                              <span class="badge bg-danger rounded-pill float-end">2</span>
                            </div>
                          </a>
                        </li>
                      }
                    }
                  </ul>
                </div>

              </div>

            </div>

            <div class="col-md-6 col-lg-7 col-xl-8">
              <div id="container" class="col-md-12" style="overflow-y: auto;">
                <div class="pt-3 pe-3" data-mdb-perfect-scrollbar-init
                     style="position: relative; height: 80vh;" id="messagesList">
                  @{
                    foreach (var message in Model.First().Messages.OrderBy(ms => ms.CreatedDate))
                    {
                      if (message.IdUser == @id)
                      {
                        <div class="d-flex flex-row justify-content-end">
                          <div>
                            <p class="small p-2 me-3 mb-1 text-white rounded-3 bg-primary">@message.Text</p>
                            <p class="small me-3 mb-3 rounded-3 text-muted">@message.CreatedDate!.Value.ToString("HH:mm | dd MMMM", new System.Globalization.CultureInfo("ru-RU"))</p>
                          </div>
                          <img src="@url"
                               alt="avatar 1" style="width: 45px; height: 100%;">
                        </div>
                      }
                      else
                      {
                        <div class="d-flex flex-row justify-content-start">
                          <img src=" @Model.First().Users.First(us =>us.Id == message.IdUser).AvtarUrl"
                               alt="avatar 1" style="width: 45px; height: 100%;">
                          <div>
                            <p class="small p-2 ms-3 mb-1 rounded-3" style="background: #bebebf">@message.Text</p>
                            <p class="small ms-3 mb-3 rounded-3 text-muted float-end">@message.CreatedDate!.Value.ToString("HH:mm | dd MMMM", new System.Globalization.CultureInfo("ru-RU"))</p>
                          </div>
                        </div>
                      }
                    }
                  }
                  
                </div>
              </div>
              <div class="text-muted d-flex justify-content-start align-items-center pe-3 pt-3 mt-2">
                <img src="@url"
                     alt="avatar 3" style="width: 40px; height: 100%;">
                <input type="text" data-url ="@url" data-id="@Model.First().Id" class="form-control form-control-lg" id="exampleFormControlInput2"
                       placeholder="Type message">
                <a class="ms-1" id="sendMessageButton"><i class="fas fa-paper-plane fa-2x" aria-hidden="true"></i></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</section>
<script  src="@Url.Content("~/js/web-socket-conection.js")" type="module" asp-append-version="true"></script>

